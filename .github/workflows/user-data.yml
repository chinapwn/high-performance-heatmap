Content-Type: multipart/mixed; boundary="==BOUNDARY=="
MIME-Version: 1.0

--==BOUNDARY==
MIME-Version: 1.0
Content-Type: text/cloud-config; charset="us-ascii"
#cloud-config
groups:
  - pan-users
  - docker

# Add users to the system. Users are added after groups are added.
users:
  - default
  - name: pan
    gecos: Photon and Neutron Cloud User
    primary_group: pan-users
    groups: docker, adm, dialout, cdrom, floppy, sudo, audio, dip, video, plugdev, lxd, netdev
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDA2uIE4QzkDkans8SC3nTo6wGxyVQx0nC8IqFDNJMrMLoQW6lbszAqcZsBHNbUEwHrMWZlvxE6WltTvy2PAqELvGx0TqVGcJfx15vQy4orm6kGc2lU29StBFJ6C2gy0Eo3JWXYB3p+qpbfmBsf5CB6pH7lrs8GamymbNb7k0epHm1ANuetyOfozCTXSVIHKBXcD96/W7t4SCYzJhMLbE3oxbnjflIvgYpucTu59vV4H8j8+PXFr8cFck/b0CniLZqRv2x4+eeeiOAf4Y2Q/8koYI4bmT1iV0bcKuOdNIrQlKkogSCic0GFFkTiUx1nGGH13igivqRsf4UwPShfK7u3 Generated-by-Nova 
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCx9nZWSiQdE/qftbn+w+tGwljYZGu7ewGaMJ+0Mj/eYX8wXUJuO91lXccATPCfcDrky3E3ztNrm8oSiSZzpa3ddLlhzabz3GOvNNeDMkwPZ/g2e/iOVZHuaH0tYb6VePzOoNFEes5K/yUMtQZheya4O+Skjc1nGXoGRfkvrbnGOm+uPSYkPvh+5fsiPtYWuNg8jzVE3JvamFbgqIdjNv8sEU1q7NSJINY1LbnweaN9JJpPKWWDp6k0DT6XL7X/bzNduDyMUHyaQDLvXQE1FkQK48neZhdSRdV/spFUEXJ3Q29JNOcO3G0dk8nn9A2Rn4zVQS7pqvzrqnaf00NRFAUzRTH6nU9NT7cNjgf93ZX5++vZf09FxOQeaZ5F6frNTsA5rpuY4MdguEh65GcgD4wejk9c51cTUv9CFaO6duASaEsFxVG5PyE+dXBdcRyWRgUcHOzWWmdGyMeZKTiiRfgKMwD1O7zheNNbduSUbbXp0AygAb1JZ+z+NIv7mkYPf5bQ2F7VqNt7/UREii3++YXOwwX0poXj6sbLU/jbSkio9j1WxmsMWEdaczo3kXaZcDtsHLdq2uzrMBHcQH4pan09HKcOZ1vUrSe+nVgylReGlL3z4YP9r74v8nhwsej8TOkJwn01ZXIGn8TI6o0kH/LM73mD06jUBKrgy954mNUMEQ== johannes.reppin@desy.de

package_update: true

fs_setup:
    - label: homeblk
      filesystem: ext4
      partition: 1
      device: /dev/vdb

mounts:
    - [/dev/vdb1, /mnt/log, "ext4", "defaults,nofail,discard", "0", "2"]

                
--==BOUNDARY==
MIME-Version: 1.0
Content-Type: text/x-shellscript; charset="us-ascii"
#!/bin/bash
# prepare host in general
## hostname and domain
hostnamectl set-hostname `hostname -s`.desy.de


--==BOUNDARY==
MIME-Version: 1.0
Content-Type: text/x-shellscript; charset="us-ascii"
#!/bin/bash
sudo apt install -y fail2ban 
curl https://releases.rancher.com/install-docker/19.03.sh | sudo sh


--==BOUNDARY==
MIME-Version: 1.0
Content-Type: text/x-shellscript; charset="us-ascii"
#!/bin/bash

echo \
docker run -d --restart=unless-stopped \
-p 80:80 \
--name hello \
-v /mnt/log:/var/log/nginx/ \
nginxdemos/hello > /home/pan/run-hello.sh
chown pan: /home/pan/run-hello.sh
chmod u+x /home/pan/run-hello.sh
/home/pan/run-hello.sh

#docker ps

